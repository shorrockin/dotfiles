# ============================================================================
# PLUGIN MANAGER & PLUGINS
# ============================================================================
# Plugin manager: https://github.com/tmux-plugins/tpm
# Install plugins: prefix + I
set -g @plugin "tmux-plugins/tpm"
set -g @plugin "tmux-plugins/tmux-sensible"

# Theme: https://github.com/omerxx/catppuccin-tmux
# Has some tweaks which make for better styling than the official plugin
set -g @plugin "omerxx/catppuccin-tmux"

# Vim/Tmux Navigator: https://github.com/christoomey/vim-tmux-navigator
# Seamlessly navigate between tmux panes and vim splits with Ctrl+[hjkl]
set -g @plugin "christoomey/vim-tmux-navigator"

# Session Resurrect: https://github.com/tmux-plugins/tmux-resurrect
# Save: prefix + Ctrl-s | Restore: prefix + Ctrl-r
set -g @plugin "tmux-plugins/tmux-resurrect"

# Continuum: https://github.com/tmux-plugins/tmux-continuum
# Auto-save every 15 minutes and restore sessions on tmux start
set -g @plugin "tmux-plugins/tmux-continuum"

# Nerd Font Window Names: https://github.com/joshmedeski/tmux-nerd-font-window-name
set -g @plugin "joshmedeski/tmux-nerd-font-window-name"

# Tmux Thumbs: https://github.com/fcsonline/tmux-thumbs
# Easy copy/paste text from tmux buffer
set -g @plugin 'fcsonline/tmux-thumbs'
run-shell ~/.tmux/plugins/tmux-thumbs/tmux-thumbs.tmux

# ============================================================================
# PLUGIN CONFIGURATION
# ============================================================================

# Continuum Settings
set -g @continuum-restore "on"
# set -g @continuum-boot "on" # Auto-start tmux on system boot

# Catppuccin Theme Settings
set -g @catppuccin_flavour "mocha"

# Window formatting
set -g @catppuccin_window_left_separator " "
set -g @catppuccin_window_right_separator ""
set -g @catppuccin_window_middle_separator "█ "
set -g @catppuccin_window_number_position "left"
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W"

# Status bar formatting
set -g @catppuccin_status_modules_right "directory session"
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_right_separator_inverse "no"
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_directory_text "#{pane_current_path}"

# ============================================================================
# TERMINAL & DISPLAY SETTINGS
# ============================================================================

# Terminal color support for both tmux and nvim
set -g default-terminal "screen-256color"
set -as terminal-features ",xterm-256color:RGB"

# Status bar position
set-option -g status-position top

# Mouse support (requires tmux 2.1+)
set -g mouse on

# Focus events for nvim integration (enables tint plugin to fade inactive panes)
set -g focus-events on

# Allow passthrough for clipboard and kitty graphics protocol (for fastfetch images)
set -g allow-passthrough on

# Native clipboard integration (tmux 2.6+)
set -g set-clipboard on

# ============================================================================
# PREFIX & BASIC OPTIONS
# ============================================================================

# Set prefix to ` instead of C-b (better ergonomics for Kinesis)
unbind C-b
set-option -g prefix `
bind ` send-prefix

# Don't detach from tmux when destroying a session; switch to next session
set-option -g detach-on-destroy off

# Start window and pane numbering at 1 instead of 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# ============================================================================
# KEY BINDINGS - PANE & WINDOW MANAGEMENT
# ============================================================================

# Pane splitting
bind - split-window -v
bind _ split-window -h

# Quick window selection with Ctrl+[1-5]
bind-key -n C-1 select-window -t 1
bind-key -n C-2 select-window -t 2
bind-key -n C-3 select-window -t 3
bind-key -n C-4 select-window -t 4
bind-key -n C-5 select-window -t 5

# Quick window selection with Alt+[1-5]
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5

# Pane navigation (works with vim-tmux-navigator)
bind -r h select-pane -L  # Move left
bind -r j select-pane -D  # Move down
bind -r k select-pane -U  # Move up
bind -r l select-pane -R  # Move right

# Pane swapping
bind > swap-pane -D       # Swap current pane with the next one
bind < swap-pane -U       # Swap current pane with the previous one

# Pane resizing
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# Window navigation
bind -r S-Left select-window -t -1
bind -r S-Right select-window -t +1

# Move current window left or right
bind -r P swap-window -t -1\; select-window -t -1
bind -r N swap-window -t +1\; select-window -t +1

# ============================================================================
# KEY BINDINGS - SESSION MANAGEMENT
# ============================================================================

# Session switcher with fuzzy finder (bound to both prefix+s and Ctrl-s)
bind s display-popup -E "~/.config/scripts/tmux-sessionizer"
bind-key -n C-s display-popup -E "~/.config/scripts/tmux-sessionizer"

# Quick toggle to last session
bind-key -n C-0 switch-client -l

# ============================================================================
# KEY BINDINGS - UTILITY
# ============================================================================

# Reload configuration file
bind r source-file ~/.tmux.conf

# Re-enable automatic window naming
bind A setw automatic-rename on

# Refresh tmux client and clear history
bind-key -n C-b send-keys -R \; clear-history

# ============================================================================
# COPY MODE SETTINGS
# ============================================================================

set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# ============================================================================
# PLUGIN MANAGER INITIALIZATION (keep at bottom)
# ============================================================================

run "~/.tmux/plugins/tpm/tpm"
