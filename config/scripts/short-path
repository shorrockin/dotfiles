#!/bin/bash
# Abbreviate path like fish prompt: ~/stripe/pay-server/lib/deep -> ~/s/p/l/deep
# Keeps last directory full, abbreviates parents to first char

path="$1"

# Replace $HOME with ~
if [[ "$path" == "$HOME" ]]; then
  echo "~"
  exit 0
fi
path="${path/#$HOME\//~/}"

if [[ "$path" == "/" ]]; then
  echo "/"
  exit 0
fi

# Split by / and process
IFS='/' read -ra parts <<< "$path"
result=""

for ((i=0; i<${#parts[@]}; i++)); do
  part="${parts[i]}"
  if [[ $i -eq $((${#parts[@]} - 1)) ]]; then
    # Last part: keep full
    result+="$part"
  elif [[ "$part" == "~" ]]; then
    result+="~/"
  elif [[ -z "$part" ]]; then
    # Leading slash (absolute path not under home)
    result+="/"
  else
    # Abbreviate to first char
    result+="${part:0:1}/"
  fi
done

echo "$result"
